<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Seller Login</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #FF6B35;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #e55a2b;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 250px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test Seller Login</h1>
        
        <div>
            <h3>1. Clear and Reset LocalStorage</h3>
            <button onclick="resetLocalStorage()">Clear & Reset LocalStorage</button>
        </div>
        
        <div>
            <h3>2. Check LocalStorage Users</h3>
            <button onclick="checkUsers()">Check Users in LocalStorage</button>
        </div>
        
        <div>
            <h3>3. Test Login</h3>
            <input type="email" id="email" placeholder="Email" value="seller@test.com">
            <input type="password" id="password" placeholder="Password" value="password">
            <br>
            <button onclick="testLogin()">Test Login</button>
        </div>
        
        <div>
            <h3>4. Direct Login Test</h3>
            <button onclick="directLoginTest()">Direct Login Test (Bypass API)</button>
        </div>
        
        <div id="result"></div>
    </div>

    <script type="module">
        // Import the login function
        let loginFunction;
        
        async function loadLoginModule() {
            try {
                const module = await import('./services/userService.ts');
                loginFunction = module.login;
                console.log('‚úÖ Login module loaded');
            } catch (error) {
                console.error('‚ùå Failed to load login module:', error);
            }
        }
        
        // Load module on page load
        loadLoginModule();
        
        window.resetLocalStorage = function() {
            try {
                localStorage.removeItem('reRideUsers');
                const FALLBACK_USERS = [
                    {
                        name: 'Prestige Motors',
                        email: 'seller@test.com',
                        password: 'password',
                        mobile: '+91-98765-43210',
                        role: 'seller',
                        location: 'Mumbai',
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        dealershipName: 'Prestige Motors',
                        bio: 'Specializing in luxury and performance electric vehicles since 2020.',
                        logoUrl: 'https://i.pravatar.cc/100?u=seller',
                        avatarUrl: 'https://i.pravatar.cc/150?u=seller@test.com',
                        isVerified: true,
                        subscriptionPlan: 'premium',
                        featuredCredits: 5,
                        usedCertifications: 1
                    }
                ];
                localStorage.setItem('reRideUsers', JSON.stringify(FALLBACK_USERS));
                showResult('‚úÖ LocalStorage cleared and reset with seller@test.com', 'success');
            } catch (error) {
                showResult('‚ùå Error resetting: ' + error.message, 'error');
            }
        };
        
        window.checkUsers = function() {
            try {
                const usersJson = localStorage.getItem('reRideUsers');
                if (!usersJson) {
                    showResult('‚ùå No users in LocalStorage', 'error');
                    return;
                }
                const users = JSON.parse(usersJson);
                let result = `üìä Found ${users.length} users in LocalStorage:\n\n`;
                users.forEach((u, i) => {
                    result += `${i + 1}. ${u.email} (${u.role})\n`;
                    result += `   Name: ${u.name}\n`;
                    result += `   Password: ${u.password ? '***' + u.password.slice(-2) : 'MISSING'}\n`;
                    result += `   Status: ${u.status}\n\n`;
                });
                showResult(result, users.length > 0 ? 'success' : 'error');
            } catch (error) {
                showResult('‚ùå Error checking users: ' + error.message, 'error');
            }
        };
        
        window.testLogin = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!loginFunction) {
                showResult('‚ùå Login module not loaded yet. Please wait...', 'error');
                return;
            }
            
            try {
                showResult('üîÑ Attempting login...', 'success');
                const result = await loginFunction({
                    email: email,
                    password: password,
                    role: 'seller'
                });
                
                if (result.success) {
                    showResult(`‚úÖ Login Successful!\n\nUser: ${result.user?.name}\nEmail: ${result.user?.email}\nRole: ${result.user?.role}`, 'success');
                } else {
                    showResult(`‚ùå Login Failed: ${result.reason || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult('‚ùå Error during login: ' + error.message, 'error');
            }
        };
        
        window.directLoginTest = function() {
            const email = document.getElementById('email').value.trim().toLowerCase();
            const password = document.getElementById('password').value.trim();
            
            try {
                const usersJson = localStorage.getItem('reRideUsers');
                if (!usersJson) {
                    showResult('‚ùå No users in LocalStorage. Click "Clear & Reset" first.', 'error');
                    return;
                }
                
                const users = JSON.parse(usersJson);
                const user = users.find(u => (u.email || '').trim().toLowerCase() === email);
                
                if (!user) {
                    showResult(`‚ùå User not found!\n\nLooking for: ${email}\n\nAvailable emails:\n${users.map(u => '- ' + u.email).join('\n')}`, 'error');
                    return;
                }
                
                const storedPassword = (user.password || '').trim();
                const passwordMatch = storedPassword === password;
                
                let result = `üìã User Found:\n`;
                result += `Name: ${user.name}\n`;
                result += `Email: ${user.email}\n`;
                result += `Role: ${user.role}\n`;
                result += `Status: ${user.status}\n`;
                result += `\nüîê Password Check:\n`;
                result += `Stored: ${storedPassword.length > 0 ? '***' + storedPassword.slice(-2) : 'EMPTY'} (length: ${storedPassword.length})\n`;
                result += `Input: ${'*'.repeat(password.length)} (length: ${password.length})\n`;
                result += `Match: ${passwordMatch ? '‚úÖ YES' : '‚ùå NO'}\n\n`;
                
                if (passwordMatch && user.role === 'seller' && user.status === 'active') {
                    result += `‚úÖ LOGIN WOULD SUCCEED!`;
                    showResult(result, 'success');
                } else {
                    result += `‚ùå LOGIN WOULD FAIL!`;
                    if (!passwordMatch) result += '\nReason: Password mismatch';
                    if (user.role !== 'seller') result += `\nReason: Wrong role (${user.role} instead of seller)`;
                    if (user.status !== 'active') result += `\nReason: Account inactive`;
                    showResult(result, 'error');
                }
            } catch (error) {
                showResult('‚ùå Error: ' + error.message, 'error');
            }
        };
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result ' + type;
            resultDiv.textContent = message;
            console.log(message);
        }
    </script>
</body>
</html>

