{
  "rules": {
    "users": {
      "$userKey": {
        "name": { ".read": true },
        "email": { ".read": true },
        "avatarUrl": { ".read": true },
        "role": { ".read": true },
        "isVerified": { ".read": true },
        "dealershipName": { ".read": true },
        "bio": { ".read": true },
        "logoUrl": { ".read": true },
        "averageRating": { ".read": true },
        "ratingCount": { ".read": true },
        "badges": { ".read": true },
        "phoneVerified": { ".read": true },
        "emailVerified": { ".read": true },
        "govtIdVerified": { ".read": true },
        "trustScore": { ".read": true },
        "subscriptionPlan": { ".read": true },
        "location": { ".read": true },
        "status": { ".read": true },
        
        ".read": "auth != null",
        ".write": "auth != null && (auth.uid == $userKey || root.child('users').child(auth.uid).child('role').val() == 'admin')",
        
        "password": {
          ".read": false,
          ".write": false
        },
        
        "mobile": {
          ".read": "auth != null && (auth.uid == $userKey || root.child('users').child(auth.uid).child('role').val() == 'admin')"
        },
        "alternatePhone": {
          ".read": "auth != null && (auth.uid == $userKey || root.child('users').child(auth.uid).child('role').val() == 'admin')"
        },
        "pendingPlanUpgrade": {
          ".read": "auth != null && (auth.uid == $userKey || root.child('users').child(auth.uid).child('role').val() == 'admin')"
        },
        
        "reportedCount": {
          ".read": false,
          ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'"
        },
        "isBanned": {
          ".read": false,
          ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'"
        },
        
        "$other": {
          ".read": "auth != null",
          ".write": "auth != null && (auth.uid == $userKey || root.child('users').child(auth.uid).child('role').val() == 'admin')"
        }
      },
      ".read": false,
      ".write": false
    },
    "vehicles": {
      "$vehicleId": {
        ".read": "data.child('status').val() == 'published' || auth != null",
        ".write": "auth != null && (data.child('sellerEmail').val() == root.child('users').child(auth.uid).child('email').val() || root.child('users').child(auth.uid).child('role').val() == 'admin' || (!data.exists() && newData.child('sellerEmail').val() == root.child('users').child(auth.uid).child('email').val()))",
        ".validate": "!newData.exists() || newData.hasChildren(['make', 'model', 'price', 'sellerEmail'])"
      },
      ".read": true,
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'"
    },
    "conversations": {
      "$conversationId": {
        ".read": "auth != null && (data.child('customerId').val() == root.child('users').child(auth.uid).child('email').val() || data.child('sellerId').val() == root.child('users').child(auth.uid).child('email').val() || root.child('users').child(auth.uid).child('role').val() == 'admin')",
        ".write": "auth != null && (data.child('customerId').val() == root.child('users').child(auth.uid).child('email').val() || data.child('sellerId').val() == root.child('users').child(auth.uid).child('email').val() || root.child('users').child(auth.uid).child('role').val() == 'admin' || (!data.exists() && (newData.child('customerId').val() == root.child('users').child(auth.uid).child('email').val() || newData.child('sellerId').val() == root.child('users').child(auth.uid).child('email').val())))",
        ".validate": "!newData.exists() || newData.hasChildren(['customerId', 'sellerId', 'vehicleId'])"
      },
      ".read": false,
      ".write": false
    },
    "notifications": {
      "$notificationId": {
        ".read": "auth != null && (data.child('recipientEmail').val() == root.child('users').child(auth.uid).child('email').val() || root.child('users').child(auth.uid).child('role').val() == 'admin')",
        ".write": "auth != null && (data.child('recipientEmail').val() == root.child('users').child(auth.uid).child('email').val() || root.child('users').child(auth.uid).child('role').val() == 'admin' || (!data.exists() && newData.child('recipientEmail').val() == root.child('users').child(auth.uid).child('email').val()))"
      },
      ".read": false,
      ".write": false
    },
    "vehicleData": {
      ".read": true,
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "$key": {
        ".read": true,
        ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'"
      }
    },
    "newCars": {
      ".read": true,
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "$carId": {
        ".read": true,
        ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'"
      }
    },
    "plans": {
      ".read": true,
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "$planId": {
        ".read": true,
        ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'"
      }
    },
    "rateLimits": {
      "$userId": {
        ".read": "auth != null && (auth.uid == $userId || root.child('users').child(auth.uid).child('role').val() == 'admin')",
        ".write": "auth != null && (auth.uid == $userId || root.child('users').child(auth.uid).child('role').val() == 'admin')"
      },
      ".read": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'"
    },
    "images": {
      ".read": true,
      ".write": "auth != null",
      "$folder": {
        ".read": true,
        ".write": "auth != null",
        "$imageId": {
          ".read": true,
          ".write": "auth != null && ((!data.exists() && newData.child('uploadedBy').exists() && newData.child('uploadedBy').val() != null && newData.child('uploadedBy').val() != '') || (data.exists() && data.child('uploadedBy').val() != null && newData.child('uploadedBy').val() == data.child('uploadedBy').val()))"
        }
      }
    },
    "$other": {
      ".read": false,
      ".write": false
    }
  }
}
